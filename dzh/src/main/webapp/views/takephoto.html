<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
        window.onload = fun();
        function fun() {
            var Devicestate = navigator.mediaDevices.getUserMedia({
                video: true
            })
            Devicestate.then(function (mediaStream) {


                video.src = window.URL.createObjectURL(mediaStream);
                console.log(mediaStream)
                video.onloadedmetadata = function (e) {
                    video.play();
                };


            });

            Devicestate.catch(function (err) {
                console.log(err.name);
            });

           
        
        }
       
        function take() {
            var outrec = document.getElementById("outrec");
            var outreccon = outrec.getContext("2d");
            outreccon.drawImage(video, 0, 0, 640, 480);


            var img = outrec.toDataURL("image/jpeg", 0.5);
            var imgvideo = document.getElementById("imgvideo");
            imgvideo.src = img;
            alert(2);
            var file = dataURLtoFile(img, "???.jpg");
            alert(1);
            
            var request = new XMLHttpRequest();
           
            request.open('post', "/s1/s1", true);
            
            
            request.setRequestHeader("Content-type","application/x-www-form-urlencoded");
            request.send("file="+file);
           

           
           
        }
        function getImgToBase64(url, callback) {//将图片转换为Base64
            var canvas = document.createElement('canvas'),
              ctx = canvas.getContext('2d'),
              img = new Image;
            img.crossOrigin = 'Anonymous';
            img.onload = function () {
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                var dataURL = canvas.toDataURL('image/png');
                callback(dataURL);
                canvas = null;
            };
            img.src = url;
        }
        function dataURLtoFile(dataurl, filename) {//将base64转换为文件
            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, { type: mime });
        }
        getImgToBase64('img/test.png', function (data) {
            var myFile = dataURLtoFile(data, 'testimgtestimgtestimg');
            console.log(myFile);
        });
    </script>
</head>
     
<body>
    <video  id="video"></video>
    
<button id="camera" onclick="take()">拍照</button>
    <!--canvs绘制-->
<canvas width="640" height="480" id="outrec"></canvas>
<!--base64绘制-->
<img id="imgvideo" style="display:none;" width="640" height="480" src="" />

</body>
</html>